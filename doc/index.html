<p><strong>PALM</strong> &mdash; <strong>Permutation Analysis of Linear Models</strong> &mdash; is a <span style="font-variant: small-caps;">Matlab</span>/Octave tool that allows inference using non-parametric, permutation methods, offering a number of features not currently available in other analysis software. These features currently include:</p>
<ul>
	<li>Ability to work with volumetric and surface-based formats, including facewise data, as well as with non-imaging data.</li>
	<li>A choice of various regression and permutation strategies;</li>
	<li>Statistics that are robust to heteroscedasticity;</li>
	<li>Shuffling of sets of observations, to allow designs with repeated measurements;</li>
	<li>Shuffling of observations with complex, tree-like covariance structure;</li>
	<li>Permutation with sign-flipping;</li>
	<li>Non-Parametric Combination (<span style="font-variant: small-caps;">npc</span>) for joint inference over multiple modalities of the same size, with various combining functions to be chosen from;</li>
	<li><span style="font-variant: small-caps;">fwer</span>-correction over multiple contrasts, multiple modalities, with or without the same size or geometry;</li>
	<li><span style="font-variant: small-caps;">fdr</span>-correction and adjustment;</li>
	<li>A fast draft mode, in which a minimum number of permutations is performed for each test.</li>
</ul>
<p><span style="font-variant: small-caps;">palm</span> is experimental software, and it will probably ever be. As novel features are included, tested, verified and validated, eventually they will be implemented and made available in <code>randomise</code>, which is part of <span style="font-variant: small-caps;">fsl</span>, and run without the need of Octave or <span style="font-variant: small-caps;">matlab</span>.</p>
<p><span style="font-variant: small-caps;">palm</span> is designed for advanced users, who are familiar with statistics and with Octave/<span style="font-variant: small-caps;">matlab</span>, and who are willing to try out cutting edge analysis tools on their research.</p>
<hr>
<h2>Downloading and installing <span style="font-variant: small-caps;">palm</span></h2>
<p>To download <span style="font-variant: small-caps;">palm</span>, <strong>click here</strong>.</p>

<p><span style="font-variant: small-caps;">palm</span> runs inside <a title="GNU Octave" href="http://www.gnu.org/software/octave/" target="_blank">Octave</a> or <a title="MATLAB" href="http://www.mathworks.co.uk/products/matlab/" target="_blank"><span style="font-variant: small-caps;">Matlab</span></a>. If you use Linux and have Octave installed, it can also run as a standalone command, with Octave being silently called behind the scenes. Each of these possibilities is detailed below.</p>
<h3>Running inside <span style="font-variant: small-caps;">Matlab</span></h3>
<p>Uncompress the downloaded file and add the newly created directory, named <code>palm</code>, to the <span style="font-variant: small-caps;">Matlab</span> path (menu File &rarr; Set Path). To invoke <span style="font-variant: small-caps;">palm</span> and see usage information, just type <code>palm</code> at the prompt.</p>
<h3>Running inside Octave</h3>
<p>Uncompress the downloaded file and add the newly created directory, named <code>palm</code>, to the Octave path. This can be done with the command <code>addpath</code>:</p>

<p><code>addpath('/full/path/to/palm')</code></p>

<p>You may want to add this line to your <code>~/.octaverc</code> file, so that the change becomes permanent. To invoke <span style="font-variant: small-caps;">palm</span> and see usage information, just type <code>palm</code> at the prompt.</p>
<h3>Running as a standalone command</h3>
<p>If you have Octave installed in your Linux system, it may be much simpler to run <span style="font-variant: small-caps;">palm</span> as a command directly from the shell, and you can easily call it from shell scripts. To do so:</p>
<ol>
	<li>Uncompress the downloaded file above.</li>
	<li>Make sure that the location of your Octave binary matches the location indicated in the first line of the script <code>palm</code> (not to be confused with the <code>palm.m</code>). In most Linux systems this is <code>/usr/bin/octave</code>, but you may need to edit the first line of the file <code>palm</code> to point to the correct location.</li>
	<li>Add the path of the directory of the <code>palm</code> command to your <code>~/.octaverc</code> file, so that Octave knows where to find all the needed functions.</li>
	<li>To invoke <span style="font-variant: small-caps;">palm</span> simply type <code>./palm</code> in the directory where you installed it. You can also add the path to your <code>$PATH</code> variable, so that you can call it easily from any directory just by typing <code>palm</code>.</li>
</ol>
<hr>
<h2>Using <span style="font-variant: small-caps;">palm</span></h2>
<p>To use <span style="font-variant: small-caps;">palm</span> for your analysis, at minimum you need to have a set of observations that are exchangeable, or that otherwise meet criteria such that permutation analysis can be used.</p>
<h3>Input options</h3>
<p>A description of the input options is below. The same information can be seen if the command <code>palm</code> is executed without arguments.</p>
<table>
<thead>
<tr>
<td><strong>Option</strong></td>
<td><strong>Description</strong></td>
</tr>
</thead>
<tbody>
<tr>
<td><code>-i &lt;file&gt;</code></td>
<td>Input(s). More than one can be specified, each one preceded by its own <code>-i</code>. All input files must contain the same number of observations (e.g., the same number of subjects). Except for <span style="font-variant: small-caps;">npc</span>, mixing is allowed (e.g., voxelwise, vertexwise and non-imaging data can be all loaded at once, and later will be all corrected across).</td>
</tr>
<tr>
<td><code>-m &lt;file&gt;</code></td>
<td>Mask(s). Either one for all inputs, or one per input, supplied in the same order as the respective <code>-i</code> appear.</td>
</tr>
<tr>
<td><code>-s &lt;file&gt;</code></td>
<td>Surface file(s). When more than one is supplied, each <code>-s</code> should be entered in the same order as the respective <code>-i</code>. This option is needed when the input data is a scalar field over a surface and spatial statistics (cluster extent, cluster mass or <span style="font-variant: small-caps;">tfce</span>) have been enabled.</td>
</tr>
<tr>
<td><code>-d &lt;file&gt;</code></td>
<td>Design matrix. It can be in <span style="font-variant: small-caps;">csv</span> format, or in <span style="font-variant: small-caps;">fsl</span>'s <span style="font-variant: small-caps;">vest</span> format. For information on how to construct the design matrix, see the <a title="FSL GLM manual" href="http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/GLM"><span style="font-variant: small-caps;">fsl glm</span> manual</a>.</td>
</tr>
<tr>
<td><code>-t &lt;file&gt;</code></td>
<td><i>t</i>-contrasts file, in <span style="font-variant: small-caps;">csv</span> or <span style="font-variant: small-caps;">vest</span> format (used by <span style="font-variant: small-caps;">fsl</span>). The option <code>-t</code> can be used more than once, so that more than one <i>t</i>-contrasts file can be loaded.</td>
</tr>
<tr>
<td><code>-f &lt;file&gt;</code></td>
<td><i>F</i>-contrasts file, in <span style="font-variant: small-caps;">csv</span> or <span style="font-variant: small-caps;">vest</span> format (used by <span style="font-variant: small-caps;">fsl</span>). Advanced: The option <code>-f</code> can be used more than once, so that more than one <i>F</i>-contrasts file can be loaded. Each file supplied with a <code>-f</code> corresponds to the file supplied with the option <code>-t</code> in the same order. The option <code>-f</code> cannot be used more than the number of times the option <code>-t</code> was used.</td>
</tr>
<tr>
<td><code>-inormal</code></td>
<td>Apply an inverse-normal transformation to the data using the Waerden method.</td>
</tr>
<tr>
<td><code>-rmethod &lt;string&gt;</code></td>
<td>Method for regression/permutation. It can be one of <code>Freedman-Lane</code>, <code>Smith</code>, <code>terBraak</code>, <code>Manly</code>, <code>Draper-Stoneman</code>, <code>Still-White</code> and <code>Huh-Jhun</code>. Default, and recommended, is <code>Freedman-Lane</code>.</td>
</tr>
<tr>
<td><code>-n &lt;integer&gt;</code></td>
<td>Number of permutations. Use <code>-n 0</code> to run all permutations and/or sign-flips exhaustively.</td>
</tr>
<tr>
<td><code>-eb &lt;file&gt;</code></td>
<td>Exchangeability blocks file, in <span style="font-variant: small-caps;">csv</span> or <span style="font-variant: small-caps;">vest</span> format. If omitted, all observations are treated as exchangeable and belonging to a single large exchangeability block.</td>
</tr>
<tr>
<td><code>-sb</code></td>
<td>Permute blocks as a whole if the block specification has a single column. Otherwise, permutations will happen within block.</td>
</tr>
<tr>
<td><code>-vg &lt;file&gt;</code></td>
<td>Variance groups file, in <span style="font-variant: small-caps;">csv</span> or <span style="font-variant: small-caps;">vest</span> format. If omitted, the variance groups are defined automatically using the exchangeability blocks (option <code>-eb</code>).</td>
</tr>
<tr>
<td><code>-ee</code></td>
<td>Assume exchangeable errors (<span style="font-variant: small-caps;">ee</span>), to allow permutations (more details below).</td>
</tr>
<tr>
<td><code>-ise</code></td>
<td>Assume independent and symmetric errors (<span style="font-variant: small-caps;">ise</span>), to allow sign-flipping (more details below).</td>
</tr>
<tr>
<td><code>-cmc</code></td>
<td>Use Conditional Monte Carlo. This option will be ignored if the number of shufflings chosen is larger than the maximum number of possible shufflings, in which case all possible shufflings will be performed.</td>
</tr>
<tr>
<td><code>-igrepx</code></td>
<td>Ignore possible repeated rows in X.</td>
</tr>
<tr>
<td><code>-twotail</code></td>
<td>Run two-tailed tests for all the t-contrasts instead of one-tailed. If <span style="font-variant: small-caps;">npc</span> is used, it becomes also two-tailed.</td>
</tr>
<tr>
<td><code>-npc</code></td>
<td>Use non-parametric combination (<span style="font-variant: small-caps;">npc</span>).</td>
</tr>
<tr>
<td><code>-cmethod &lt;string&gt;</code></td>
<td>Method for combination in the <span style="font-variant: small-caps;">npc</span>. It can be one of: <code>Tippett</code>, <code>Fisher</code>, <code>Pearson-David</code>, <code>Stouffer</code>, <code>Wilkinson &lt;alpha&gt;</code>, <code>Winer</code>, <code>Edgington</code>, <code>Mudholkar-George</code>, <code>Friston</code>, <code>Darlington-Hayes &lt;r&gt;</code>, <code>Zaykin &lt;alpha&gt;</code>, <code>Dudbridge-Koeleman &lt;r&gt;</code>, <code>Dudbridge-Koeleman2 &lt;r&gt; &lt;alpha&gt;</code>, <code>Nichols</code>, <code>Taylor-Tibshirani</code> or <code>Jiang &lt;alpha&gt;</code>. Default is <code>Tippett</code>. Note that some methods require 1 or 2 additional parameters to be provided.</td>
</tr>
<tr>
<td><code>-o &lt;string&gt;</code></td>
<td>Output prefix. It may itself be prefixed by a path. Default is <code>palm</code>.</td>
</tr>
<tr>
<td><code>-c &lt;real&gt;</code></td>
<td>Enable cluster extent for <i>t</i> contrasts, with the supplied cluster-forming threshold.</td>
</tr>
<tr>
<td><code>-C &lt;real&gt;</code></td>
<td>Enable cluster mass for <i>t</i> contrasts, with the supplied cluster-forming threshold.</td>
</tr>
<tr>
<td><code>-F &lt;positive&gt;</code></td>
<td>Enable cluster extent for <i>F</i> contrasts, with the supplied cluster-forming threshold.</td>
</tr>
<tr>
<td><code>-S &lt;positive&gt;</code></td>
<td>Enable cluster mass for <i>F</i> contrasts, with the supplied cluster-forming threshold.</td>
</tr>
<tr>
<td><code>-T</code></td>
<td>Enable <span style="font-variant: small-caps;">tfce</span> inference for 3D (volume) data, i.e., with <em>H</em> = 2, <em>E</em> = 0.5, <em>C</em> = 6.</td>
</tr>
<tr>
<td><code>-T2</code></td>
<td>Enable <span style="font-variant: small-caps;">tfce</span> inference for 2D (surface, <span style="font-variant: small-caps;">tbss</span>) data, i.e., <em>H</em> = 2, <em>E</em> = 1, <em>C</em> = 26.</td>
</tr>
<tr>
<td><code>-cnpc &lt;real&gt;</code></td>
<td>Enable <span style="font-variant: small-caps;">npc</span> cluster extent, with the supplied cluster-forming threshold (z-stat).</td>
</tr>
<tr>
<td><code>-Cnpc &lt;real&gt;</code></td>
<td>Enable <span style="font-variant: small-caps;">npc</span> cluster mass, with the supplied cluster-forming threshold (z-stat).</td>
</tr>
<tr>
<td><code>-Tnpc</code></td>
<td>Enable <span style="font-variant: small-caps;">tfce</span> inference for <span style="font-variant: small-caps;">npc</span> on 3D data, with <em>H</em> = 2, <em>E</em> = 0.5, <em>C</em> = 6.</td>
</tr>
<tr>
<td><code>-T2npc</code></td>
<td>Enable <span style="font-variant: small-caps;">tfce</span> inference for <span style="font-variant: small-caps;">npc</span> on 2D data, i.e., <em>H</em> = 2, <em>E</em> = 1, <em>C</em> = 26.</td>
</tr>
<tr>
<td><code>-tfce_H &lt;real&gt;</code></td>
<td>Set the <span style="font-variant: small-caps;">tfce</span> <em>H</em> parameter (height power).</td>
</tr>
<tr>
<td><code>-tfce_E &lt;real&gt;</code></td>
<td>Set the <span style="font-variant: small-caps;">tfce</span> <em>E</em> parameter (extent power).</td>
</tr>
<tr>
<td><code>-tfce_C &lt;integer&gt;</code></td>
<td>Set the <span style="font-variant: small-caps;">tfce</span> <em>C</em> parameter (connectivity).</td>
</tr>
<tr>
<td><code>-corrmod</code></td>
<td>Apply <span style="font-variant: small-caps;">fwer</span>-correction of p-values over multiple modalities.</td>
</tr>
<tr>
<td><code>-corrcon</code></td>
<td>Apply <span style="font-variant: small-caps;">fwer</span>-correction of p-values over multiple contrasts.</td>
</tr>
<tr>
<td><code>-fdr</code></td>
<td>Produce <span style="font-variant: small-caps;">fdr</span>-adjusted p-values.</td>
</tr>
<tr>
<td><code>-saveparametric</code></td>
<td>Save also uncorrected parametric p-values.</td>
</tr>
<tr>
<td><code>-save1-p</code></td>
<td>Save (1-p) instead of the actual p-values.</td>
</tr>
<tr>
<td><code>-logp</code></td>
<td>Save the output p-values as -log(p) (or -log(1-p) if the option <code>-save1-p</code> is used).</td>
</tr>
<tr>
<td><code>-savemask</code></td>
<td>Save the effective masks used for each modality.</td>
</tr>
<tr>
<td><code>-noniiclass</code></td>
<td>Do not use the <span style="font-variant: small-caps;">nifti</span> class (use this option only if you have problems and for small datasets).</td>
</tr>
<tr>
<td><code>-draft</code></td>
<td>Run in the "draft mode". No <span style="font-variant: small-caps;">fwer</span> correction is possible, only <span style="font-variant: small-caps;">fdr</span>-adjustment.</td>
</tr>
<tr>
<td><code>-saveperms</code></td>
<td>Save one statistic image per permutation, as well as a <span style="font-variant: small-caps;">csv</span> file with the permutation indices (one permutation per row, one index per column; sign-flips are represented by the negative indices). Use cautiously, as this may consume large amounts of disk space.</td>
</tr>
<tr>
<td><code>-seed &lt;positive&gt;</code></td>
<td>Seed used for the random number generator. Use a positive integer up to 2^32. Default is <code>0</code>. To start with a random number, use the word <code>twist</code> instead of the integer. Note that a given seed used in <span style="font-variant: small-caps;">matlab</span> isn't equivalent to the same seed used in Octave.</td>
</tr>
<tr>
<td><code>-shrink</code></td>
<td>Remove observations that are zeroed out among the regressors of interest and which don't belong to the currently tested contrast. This option cannot be used together with <code>-corrcon</code>.</td>
</tr>
<tr>
<td><code>-zstat</code></td>
<td>Convert the original statistic (<i>t</i>, <i>F</i>, <i>v</i> or <i>G</i>) to a normally distributed, <i>z</i>-statistic. In addition to having gaussianized statistics, this option allows correction over contrasts that are not of the same rank (i.e., using the option <code>-corrcon</code>).</td>
</tr>
</tbody>
</table>
<h3>Input files</h3>
<p>Input files are recognised by the file extension:</p>
<table>
<thead>
<tr><td><b>Extension</b></td><td><b>Read as</b></td></tr>
</thead>
<tbody>
<tr><td><code>nii</code>, <code>hdr</code>, <code>img</code></td><td><span style="font-variant: small-caps;">nifti</span> file. Can be used to input data (option <code>-i</code>) and mask (<code>-m</code>). Note that the old <span style="font-variant: small-caps;">analyze</span> format is not supported.</td></tr>
<tr><td><code>nii.gz</code></td><td>Compressed <span style="font-variant: small-caps;">nifti</span> file. Should be uncompressed manually (with <code>gunzip</code>) and loaded as <code>nii</code> (it uses more disk space, but far less <span style="font-variant: small-caps;">ram</span>). Can only be read directly with the option <code>-noniiclass</code>.</td></tr>
<tr><td><code>mgh</code>, <code>mgz</code></td><td>FreeSurfer data, either volumetric or surface-based. Can be used to input data (option <code>-i</code>) or mask for the same kind of data (option <code>-m</code>).</td></tr>
<tr><td><code>dpv</code>, <code>dpf</code>, <code>dpx</code></td><td>Data-per-vertex (vertexwise), data-per-face (facewise), or unspecified surface-based data. Can be used to specify a mask (option <code>-m</code>) for surface-based data. Multiple such files can be merged into a <span style="font-variant: small-caps;">csv</span> table, and then input with the option <code>-i</code>; see details below.</td></tr>
<tr><td><code>csv</code></td><td><span style="font-variant: small-caps;">csv</span> table. Can be used to specify input data (option <code>-i</code>), mask for the same kind of data (option <code>-m</code>), design matrix (option <code>-d</code>), contrasts (options <code>-t</code> and <code>-f</code>), exchangeability blocks (<code>-eb</code>) and variance groups (<code>-vg</code>).</td></tr>
<tr><td><code>mat</code>, <code>con</code>, <code>fts</code>, <code>grp</code></td><td>Table in <span style="font-variant: small-caps;">fsl vest</span> format. Can be used essentially in the same way as <span style="font-variant: small-caps;">csv</span> files, i.e., to specify input data (option <code>-i</code>), mask for the same kind of data (<code>-m</code>) design matrix (<code>-d</code>), contrasts (options <code>-t</code> and <code>-f</code>), exchangeability blocks (<code>-eb</code>) and variance groups (<code>-vg</code>).</td></tr>
<tr><td><code>srf</code></td><td>Surface in <span style="font-variant: small-caps;">ascii</span> format (option <code>-s</code>).</td></tr>
<tr><td><code>inflated</code>, <code>nofix</code>, <code>orig</code>, <code>pial</code>, <code>smoothwm</code>, <code>sphere</code>, <code>reg</code>, <code>white</code></td><td>Files with these extensions are read as FreeSurfer surface (option <code>-s</code>).</td></tr>
</tbody>
</table>
<p>Files with extensions not listed above won't be read.</p>

<h4>Support for <span style="font-variant: small-caps;">nifti</span> files</h4>
<p>Support for <a title="The NIFTI file format" href="http://brainder.org/2012/09/23/the-nifti-file-format/" target="_blank"><span style="font-variant: small-caps;">nifti</span> files</a> is provided, internally, by the publicly available <a title="NIFTI class for MATLAB" href="http://sourceforge.net/projects/niftilib/files/niftimatlib/" target="_blank"><span style="font-variant: small-caps;">nifti</span> class</a>. This allows reading and writing even huge files without using too much computer <span style="font-variant: small-caps;">ram</span>. However, the <span style="font-variant: small-caps;">nifti</span> class does not operate on compressed files, i.e., with extension <code>.nii.gz</code>. To read these files, it is recommended that they are uncompressed (with <code>gunzip</code>).</p>

<p>Alternatively, if the datasets are small, and if you have either <span style="font-variant: small-caps;">fsl</span> or FreeSurfer installed, you can disable the <span style="font-variant: small-caps;">nifti</span> class with the option <code>-noniiclass</code>. This allows to read/write these <code>.nii.gz</code> files directly. However, if these files are too big when uncompressed, this can easily use all the computer memory and your system may become unstable until it is (possibly) restarted. So, use with this option with great caution.</p>

<p>The <span style="font-variant: small-caps;">nifti</span> class, that is used by default, already comes with precompiled binaries for <span style="font-variant: small-caps;">Matlab</span> in various platforms, and for Octave for most 64-bit Linux distributions. If you need to compile it for your distribution, use:</p>
<code>cd /full/path/to/palm/niftimatlib/matlab/@file_array/private<br>
./compile.sh</code>

<h4>Support for FreeSurfer files</h4>
<p>To be able to read/write FreeSurfer binary files (surfaces and curvatures), <a title="FreeSurfer" href="http://surfer.nmr.mgh.harvard.edu/" target="_blank">FreeSurfer</a> needs to be installed and configured correctly in your system. Surface files in <a title="Braindering with ASCII files" href="http://brainder.org/2011/09/25/braindering-with-ascii-files/" target="_blank">ASCII format</a> are read directly by <span style="font-variant: small-caps;">palm</span> as long as their file extension is <code>srf</code>, so FreeSurfer isn't necessary for these files.</p>

<p>Freesurfer "curvature" files converted to <span style="font-variant: small-caps;">ascii</span> (<span style="font-variant: small-caps;">asc</span>/<span style="font-variant: small-caps;">dpv</span>/<span style="font-variant: small-caps;">dpf</span>/<span style="font-variant: small-caps;">dpx</span>) need to be merged and converted to <span style="font-variant: small-caps;">csv</span> tables. To generate a valid <span style="font-variant: small-caps;">csv</span> file, use the command <code>dpx2csv</code> (available in <span style="font-variant: small-caps;">palm</span>, or <a href="dpx2csv"><b>here</b></a>) to make the <span style="font-variant: small-caps;">csv</span> file, initially with one column per subject and one row per vertex or face, then transpose the rows and columns of this file with the command <code>transpose</code> (also available in <span style="font-variant: small-caps;">palm</span>, or <a href="transpose"><b>here</b></a>).</p>

<h4>Support for <span style="font-variant: small-caps;">csv</span> files</h4>
<p>Although <span style="font-variant: small-caps;">palm</span> was created with imaging in mind, it can be used for non-imaging data. Any kind of data that can be arranged in a table and saved as comma-separated values file (<span style="font-variant: small-caps;">csv</span>) (i.e., <i>any</i> data) can be used as input. Each row constitutes a subject or observation, and each column represents a measurement. <span style="font-variant: small-caps;">csv</span> files must contain numeric fields only, i.e., title labels are not accepted and will cause errors.</p>

<p>If your data is arranged as space- or tab-separated values instead of comma-separated values, it can be converted quickly using <code>awk</code> (or <code>gawk</code>). Just run:</p>

<code>awk 'BEGIN { OFS="," } { $1=$1; print $0 }' oldfile.txt &gt; newfile.csv</code>

<p>If your data has any other separator, e.g., a semicolon, the same applies with using a small modification:</p>

<code>awk 'BEGIN { FS="x"; OFS="," } { $1=$1; print $0 }' oldfile.txt &gt; newfile.csv</code>

<p>Just replace the <code>"x"</code> for the separator in your original table (e.g., a semicolon).</p>

<h4>Support for other file formats</h4>
<p>If there is a file format that cannot be easily converted to <span style="font-variant: small-caps;">csv</span>, and which you'd like to be able to read directly in <span style="font-variant: small-caps;">palm</span>, feel free to contact us. New formats may be added for future releases.</p>

<h3>Permutations or sign-flips?</h3>
<p>Exchangeable errors (<span style="font-variant: small-caps;">ee</span>) are assumed by default, such that permutations are performed. If the option <code>-ise</code> is supplied, the errors are instead assumed to be independent and symmetric (<span style="font-variant: small-caps;">ise</span>), and only sign-flips are performed. If both <code>-ee</code> and <code>-ise</code> options are given, the errors are treated as being exchangeable, independent and symmetric, and both permutations and sign-flips are performed.</p>
<h3>Defining exchangeability blocks</h3>
<p>A basic definition of exchangeable blocks can be made using a text file with one column of positive integers representing the blocks, i.e., one value per line. This file is supplied with the option <code>-eb</code>, and indicates that the observations corresponding to each line can only be shuffled within block of the same index. If a file with this simple structure is given with <code>-eb</code> and the option <code>-sb</code> (permute blocks) is used, then the blocks are permuted as a whole, with the order of observations inside each block being kept unchanged. If the option <code>-ise</code> is used, sign-flips ignore block definitions unless the option <code>-sb</code> is given, in which case the signs of the blocks as a whole are flipped.</p>

<p>While the simple block specification as above, with just one column of indices, can cover various designs with structured dependence between observations, cases of more complex structure can be accommodated using multiple, nested block definitions. In this case, the file containing the block definitions needs not just one, but multiple columns, each with a sequentially deeper level of dependence. Indices on one level indicate how the indices of the next level should be permuted. Positive indices at one level indicate that the corresponding indices of the next level should be permuted as a whole, akin to whole-block permutation with the <code>-sb</code> option described above. Negative indices at one level indicate that the corresponding indices in the next level should not be permutted, and their own subindices should be permuted within block, akin to within-block permutation described above. With this more complex structure, the option <code>-sb</code>, even if supplied, is ignored, as this information is embedded, at multiple levels, in the file with the block definitions.</p>

<p>For more details and examples, <a href="blocks.html"><b>click here</b></a>.</p>
<h3>Output files</h3>
<p>All output file names are prefixed by the string supplied with the option <code>-o</code>. If this option is not supplied, the outputs will be saved to the directory from which <span style="font-variant: small-caps;">palm</span> is executed, all named as <code>result_*</code>. The file names follow a consistent convention described below, which depends on whether the option <code>-npc</code> is used or not.</p>

<p>The format of the outputs is the same as the input data (supplied with the option <code>-i</code>, collapsed along the dimension of the observations, i.e., the 4th dimension for 4D datasets (<span style="font-variant: small-caps;">nifti</span> or FreeSurfer surface formats), or the 1st dimension (rows) of <span style="font-variant: small-caps;">csv</span> files or 2D <span style="font-variant: small-caps;">nifti</span> files.</p>
<p>There are 2 outputs of general interest: the statistic image and its associated p-value. Additionally, a small text file in <span style="font-variant: small-caps;">csv</span> format is saved containing the degrees of freedom associated with the statistic. If the option <code>-saveperms</code> is used, the statistic computed for each permutation is also saved, as well as a table with the permutation indices for these images. These files are named according to the following convention:</p>

<table>
<thead>
<tr>
<td><b>File name</b></td>
<td><b>File contents</b></td>
</tr>
</thead>
<tbody>
<tr>
<td><code>{prefix}_{unit}_{stat}_mod{#}_con{#}.{ext}</code></td>
<td>Statistic for the modality <code>mod{#}</code> and for the contrast <code>con{#}</code>.</td>
</tr>
<tr>
<td><code>{prefix}_{unit}_{stat}_{pval}_mod{#}_con{#}.{ext}</code></td>
<td>P-value for the modality <code>mod{#}</code> and for the contrast <code>con{#}</code>.</td>
</tr>
<tr>
<td><code>{prefix}_{unit}_{stat}_mod{#}_con{#}.dof</code></td>
<td>A text file containing the degrees of freedom for the statistic computed for the modality <code>mod{#}</code> and for the contrast <code>con{#}</code>. This is only useful if you'd like to refer to the parametric distribution to find the p-values (which can, nonetheless, be produced directly with the option <code>-saveparametric</code>.</td>
</tr>
<tr>
<td><code>{prefix}_{unit}_{stat}_mod{#}_con{#}_perm{#}.{ext}</code></td>
<td>Statistic for the permutation <code>perm{#}</code> for the modality <code>mod{#}</code> and for the contrast <code>con{#}</code>, if the option <code>-saveperms</code> is used.</td>
</tr>
<tr>
<td><code>{prefix}_{unit}_{stat}_mod{#}_con{#}_permidx.csv</code></td>
<td>Permutation indices, with negatives for the sign flips, if the option <code>-saveperms</code> is used. This <span style="font-variant: small-caps;">csv</span> file has one row per permutation and one column per permutation index.</td>
</tr>
</tbody>
</table>

<p>Each of these fields are:</p>
<table>
<thead>
<tr>
<td><b>Field</b></td>
<td><b>Description</b></td>
</tr>
</thead>
<tbody>
<tr>
<td><code>{prefix}</code></td>
<td>The prefix supplied with the option <code>-o</code>, which can contain full path information. If <code>-o</code> isn't supplied, the default prefix is <code>result</code>.</td>
</tr>
<tr>
<td><code>{unit}</code></td>
<td>The unit in space in which the statistic is calculated. This can be <code>vox</code> for voxelwise, <code>vtx</code> for vertexwise, <code>fac</code> for facewise, <code>dpx</code> or surface-data without specification (it can be vertexwise or facewise if the actual surface geometry wasn't supplied with the <code>-s</code> option), <code>dat</code> for any data that doesn't necessarily have a spatial meaning (e.g., data entered in <span style="font-variant: small-caps;">csv</span> format), <code>clustere</code> for cluster extent, <code>clusterm</code> for cluster mass, or <code>tfce</code> for <span style="font-variant: small-caps;">tfce</span>.</td>
</tr>
<tr>
<td><code>{stat}</code></td>
<td>The name of the statistic, which can be <code>tstat</code> for the <i>t</i>-statistic, <code>fstat</code> for the <i>F</i>-statistic, <code>vstat</code> for the Aspin&ndash;Welch's <i>v</i>-statistic or <code>gstat</code> for the <i>G</i>-statistic (<em>v</em>&sup2;), or <code>npc</code> for the z-score of the chosen <span style="font-variant: small-caps;">npc</span> combining method.</td>
</tr>
<tr>
<td><code>{pval}</code></td>
<td>The kind of p-value stored in the image. It can be <code>uncp</code> for uncorrected permutation p-values, <code>fwep</code> for the p-values <span style="font-variant: small-caps;">fwer</span> corrected within modality and contrast, <code>fwecp</code> for the p-values <span style="font-variant: small-caps;">fwer</span> corrected across contrasts if the option <code>-corrcon</code> was used (so, within modality), <code>fwemp</code> for the p-values <span style="font-variant: small-caps;">fwer</span> corrected across modalities if the option <code>-corrmod</code> was used (so, within contrast), <code>fwecmp</code> for the p-values <span style="font-variant: small-caps;">fwer</span> corrected across modalities and contrasts, <code>fdrp</code> for p-value <span style="font-variant: small-caps;">fdr</span> adjusted within modality and contrast, <code>uncparap</code> uncorrected parametric p-value and <code>fdrparap</code> parametric <span style="font-variant: small-caps;">fdr</span>-corrected p-value.</td>
</tr>
<tr>
<td><code>mod{#}</code></td>
<td>Modality index, in the same order as supplied as input with the option <code>-i</code>. This is omitted for the <span style="font-variant: small-caps;">npc</span> statistics.</td>
</tr>
<tr>
<td><code>con{#}</code></td>
<td>Contrast index, in the same order as in the files supplied with the <code>-t</code> and/or <code>-f</code> options.</td>
</tr>
<tr>
<td><code>perm{#}</code></td>
<td>Statistic map for the permutation <code>perm{#}</code> if the option <code>-saveperms</code> is used.</td>
</tr>
<tr>
<td><code>{ext}</code></td>
<td>File extension. This will typically be the same extension as the corresponding input files.</td>
</tr>
</tbody>
</table>
<hr>
<h2>Comparison with randomise</h2>
<p>Compared to <span style="font-variant: small-caps;">fsl</span>'s randomise, <span style="font-variant: small-caps;">palm</span> performs overall the same kind of non-parametric test, offering various new features. A comparison is shown below:</p>
<table>
<thead>
<tr>
<td><strong>Feature</strong></td>
<td><strong>randomise</strong></td>
<td><strong><span style="font-variant: small-caps;">palm</span></strong></td>
</tr>
</thead>
<tbody>
<tr>
<td>Input formats</td>
<td><span style="font-variant: small-caps;">nifti</span>.</td>
<td><span style="font-variant: small-caps;">csv</span>, <span style="font-variant: small-caps;">nifti</span>, FreeSurfer surface formats (curvature), including <span style="font-variant: small-caps;">ascii</span> vertexwise and facewise.</td>
</tr>
<tr>
<td>Univariate statistics</td>
<td><em>t</em> and <em>F.</em></td>
<td><em>t</em>, <em>F</em>, Aspin&ndash;Welch's <em>v</em> and <em>v</em>&sup2; (<em>G</em>).</td>
</tr>
<tr>
<td>Spatial statistics</td>
<td>Cluster extent, cluster mass, <span style="font-variant: small-caps;">tfce</span>. All of these can be voxelwise only.</td>
<td>Cluster extent, cluster mass, <span style="font-variant: small-caps;">tfce</span>. All of these can be voxelwise, vertexwise or facewise.</td>
</tr>
<tr>
<td>Regression and permutation strategies</td>
<td>Freedman&ndash;Lane.</td>
<td>Draper&ndash;Stoneman, Still&ndash;White, Freedman&ndash;Lane, ter Braak, Manly, Huh&ndash;Jhun, Smith and parametric (no permutation).</td>
</tr>
<tr>
<td>Shuffling possibilities</td>
<td>Permutations or sign-flippings.</td>
<td>Permutations, sign-flippings, and permutations with sign-flippings.</td>
</tr>
<tr>
<td>Block permutation</td>
<td>Either whole-block or within-block.</td>
<td>Whole-block and/or within-block, either in isolation or in arbitrary combinations, with multiple and complex levels of dependence between observations.</td>
</tr>
<tr>
<td>Variance groups</td>
<td>One. Cannot be changed.</td>
<td>Multiple. Can be set automatically or defined by the user.</td>
</tr>
<tr>
<td>Input datasets (modalities)</td>
<td>One.</td>
<td>Multiple.</td>
</tr>
<tr>
<td>Joint inference across modalities</td>
<td>No.</td>
<td>Yes. Various combining functions available: Tippett, Fisher, Pearson&ndash;David, Stouffer, Wilkinson, Winer, Edgington, Mudholkar&ndash;George, Friston, Darlington&ndash;Hayes, Zaykin, Dudbridge&ndash;Koeleman (2 variants), Nichols, Taylor&ndash;Tibshirani and Jiang.</td>
</tr>
<tr>
<td><span style="font-variant: small-caps;">fwer</span> correction</td>
<td>Within each contrast only.</td>
<td>Within contrast, across contrasts, within modality, across modalities, and across modalities and contrasts.</td>
</tr>
<tr>
<td><span style="font-variant: small-caps;">fdr</span> correction</td>
<td>Yes, separate command.</td>
<td>Yes, built-in.</td>
</tr>
<tr>
<td>Post hoc non-stationarity correction</td>
<td>Yes.</td>
<td>No.</td>
</tr>
<tr>
<td>Voxelwise regressors</td>
<td>Yes.</td>
<td>No.</td>
</tr>
<tr>
<td>Fast draft mode</td>
<td>No.</td>
<td>Yes.</td>
</tr>
<tr>
<td>Overall performance</td>
<td>Slower, except for <span style="font-variant: small-caps;">tfce</span>.</td>
<td>Faster, except for <span style="font-variant: small-caps;">tfce</span>.</td>
</tr>
<tr>
<td>Language</td>
<td>Written in C++.</td>
<td>Written in <span style="font-variant: small-caps;">Matlab</span>/Octave.</td>
</tr>
<tr>
<td>License</td>
<td>Free for academic use.</td>
<td>Free (<a href="http://www.gnu.org/licenses/gpl.html" target="_blank" name="General Public License"><span style="font-variant: small-caps;">gpl</span></a>).</td>
</tr>
</tbody>
</table>
<hr>
<h2>References</h2>
<ul>
<li>Winkler AM, Ridgway GR, Webster MA, Smith SM, Nichols TE. Permutation inference for the general linear model. 2013. <i>(submitted)</i></li>
<li>Nichols TE, Holmes AP. Nonparametric permutation tests for functional neuroimaging: a primer with examples. <i>Hum Brain Mapp.</i> 2002 Jan;15(1):1-25.</li>
<li>Holmes AP, Blair RC, Watson JD, Ford I. Nonparametric analysis of statistic images from functional mapping experiments. J Cereb Blood Flow Metab. 1996 Jan;16(1):7-22.</li>
</ul>
<h2>Acknowledgements</h2>
xx
<h2>Version history</h2>
xx
<hr>